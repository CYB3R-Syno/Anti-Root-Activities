# CVE-2018-0802 / Microsoft Memory Corruption Vulnerability
작성자 : Syno 

해당 취약점은 소프트웨어가 메모리의 개체를 제대로 처리하지 못하여 발생하는 메모리 손상 취약점이다.     
취약점이 성공적으로 악용되며 해당 공격자는 시스템을 제어할 수 있다.    
또한 공격자가 프로그램을 설치할 수 있으며 새로운 계정을 생성하거나 데이터를 보는 등 여러가지를 할 수 있다.

#### 취약점에 영향을 받는 버전
- MS office 2016
- MS office 2013
- MS office 2010
- MS office 2007

<hr>

참고 글

[[MS Office] 취약점 CVE-2018-0802](https://m.blog.naver.com/sunkwang0307/221382978088)     
[Microsoft Office 메모리 손상 취약점 (CVE-2018-0802)](https://two2sh.tistory.com/18)

<hr>

## 환경구축
- Windows 7     
- MS office 2010

1. [Windows 7 iso Download](https://tech-latest.com/download-windows-7-iso/) -> vmware -> windows 7 install     
2. MS office 2010 Download

<img width="1478" alt="Screen Shot 2022-02-09 at 4 17 21 AM" src="https://user-images.githubusercontent.com/84657474/153059467-b0e8314d-c852-481b-9483-b8a11c5e256e.png">

<hr>

## 발생 원인
CVE-2018-0802 취약점은 Office 문서에 수식을 삽인하고 편집을할 떄 사용하는 컴포터는 eqnedt32.exe에서 발생한다.     
eqnedt32.exe에서 폰트 레코드명을 처리하는 과정 중 원본과 대상 버퍼의 크기를 체크하지 않으며 공격에 취약한 strcpy()가 사용된다.

Microsoft에 2017년 11월 패치 이후에 ```SUB_41160F()``` 함수의 strcpy() 전후 버퍼 크기를 확인하는 코드가 추가되었지만, ```SUB_421E39()``` 함수에 대해서는 조치가 취해지지 않았다고 한다.


## PoC
<img width="1688" alt="Screen Shot 2022-02-08 at 4 33 25 AM" src="https://user-images.githubusercontent.com/84657474/152858809-05ecf149-9fc7-4d89-a30c-3503ea220307.png">

<img width="1688" alt="Screen Shot 2022-02-08 at 4 34 09 AM" src="https://user-images.githubusercontent.com/84657474/152858906-f5628fc7-566f-496a-9d64-f706470d3d6d.png">

<img width="1478" alt="Screen Shot 2022-02-09 at 4 21 15 AM" src="https://user-images.githubusercontent.com/84657474/153060036-8328c501-7354-44d6-8008-4216e92b75f5.png">

<img width="1478" alt="Screen Shot 2022-02-09 at 4 21 52 AM" src="https://user-images.githubusercontent.com/84657474/153060145-92053136-3ef2-4913-a334-50a48540be51.png">

<img width="1713" alt="Screen Shot 2022-02-09 at 4 22 16 AM" src="https://user-images.githubusercontent.com/84657474/153060196-8fbb5c37-bfa3-43e4-b299-331077cd93a7.png">

<img width="1713" alt="Screen Shot 2022-02-09 at 4 23 00 AM" src="https://user-images.githubusercontent.com/84657474/153060323-d78422f8-9388-48bb-a61f-6d6c46c23bf1.png">


